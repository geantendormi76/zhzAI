2025-06-05 12:28:45,313 - INFO - RagServiceLogger - rag_mcp_service.py:36 - --- RagServiceLogger configured to write to rag_service_debug.log ---
2025-06-05 12:28:47,389 - WARNING - RagServiceLogger - rag_mcp_service.py:70 - .env file not found at /home/zhz/zhz_agent/zhz_rag/api/.env, will rely on environment variables or defaults.
2025-06-05 12:28:47,398 - INFO - RagServiceLogger - rag_mcp_service.py:471 - --- Starting RAG Service (FastMCP for mcpo via direct run) ---
2025-06-05 12:28:47,401 - INFO - RagServiceLogger - rag_mcp_service.py:88 - --- RAG Service (FastMCP): 正在初始化 RAG 组件 (新版) ---
2025-06-05 12:28:47,958 - INFO - RagServiceLogger - rag_mcp_service.py:113 - RAG Service: ChromaDBRetriever 初始化成功。
2025-06-05 12:28:47,959 - INFO - RagServiceLogger - rag_mcp_service.py:127 - RAG Service: FileBM25Retriever 初始化成功。
2025-06-05 12:28:47,965 - INFO - RagServiceLogger - rag_mcp_service.py:136 - RAG Service: KGRetriever 初始化成功。
2025-06-05 12:28:47,965 - INFO - RagServiceLogger - fusion_engine.py:41 - FusionEngine: Loading reranker model from: /home/zhz/models/bge-reranker-base to cuda...
2025-06-05 12:28:48,998 - INFO - RagServiceLogger - fusion_engine.py:59 - FusionEngine: Reranker model loaded to GPU and using FP16.
2025-06-05 12:28:48,999 - INFO - RagServiceLogger - fusion_engine.py:64 - FusionEngine: Reranker model loading successful!
2025-06-05 12:28:48,999 - INFO - RagServiceLogger - rag_mcp_service.py:145 - RAG Service: FusionEngine 初始化成功。
2025-06-05 12:28:48,999 - INFO - RagServiceLogger - rag_mcp_service.py:149 - --- RAG Service (FastMCP): RAG 组件初始化尝试完成。---
2025-06-05 12:31:07,864 - INFO - RagServiceLogger - rag_mcp_service.py:181 - 
--- RAG Service (query_rag_v2): 接收到查询: '张三在哪里工作？' ---
2025-06-05 12:31:07,864 - INFO - RagServiceLogger - rag_mcp_service.py:182 -       Params: top_k_vector=5, top_k_kg=3, top_k_bm25=3, top_k_final=3
2025-06-05 12:31:07,864 - INFO - RagServiceLogger - rag_mcp_service.py:200 - --- [TIME] 开始意图分类 at 0.00s ---
2025-06-05 12:31:23,809 - INFO - RagServiceLogger - rag_mcp_service.py:204 - --- [TIME] 结束意图分类, 耗时: 15.94s. Result: {'clarification_needed': False, 'reason': ''}
2025-06-05 12:31:23,809 - INFO - RagServiceLogger - rag_mcp_service.py:220 - --- 查询清晰，无需澄清。将对原始查询 '张三在哪里工作？' 进行查询扩展 ---
2025-06-05 12:31:38,096 - INFO - RagServiceLogger - rag_mcp_service.py:232 - --- 扩展后的查询列表 (共 4 个): ['张三目前的具体工作地点是哪里？', '张三的工作地点属于哪个城市或区域？', '张三是否在全职或兼职状态下工作？', '张三在哪里工作？']. 耗时: 14.29s ---
2025-06-05 12:31:38,096 - INFO - RagServiceLogger - rag_mcp_service.py:237 - --- [TIME] 开始并行召回 for 4 queries at 30.23s ---
2025-06-05 12:31:38,096 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '张三目前的具体工作地点是哪里？'
2025-06-05 12:31:38,821 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '张三目前的具体工作地点是哪里？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7867591364914212, 'distance': 0.4264817270171577, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6887914454651377, 'distance': 0.6224171090697246, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:31:38,822 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '张三目前的具体工作地点是哪里？': found 2 docs.
2025-06-05 12:31:39,271 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '张三目前的具体工作地点是哪里？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.5145924687385559}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}]
2025-06-05 12:31:39,274 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '张三目前的具体工作地点是哪里？': found 2 potential docs.
2025-06-05 12:31:39,274 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '张三目前的具体工作地点是哪里？'
2025-06-05 12:31:45,069 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '张三目前的具体工作地点是哪里？' raw output: []
2025-06-05 12:31:45,069 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '张三目前的具体工作地点是哪里？': found 0 results.
2025-06-05 12:31:45,069 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '张三的工作地点属于哪个城市或区域？'
2025-06-05 12:31:45,085 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '张三的工作地点属于哪个城市或区域？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7641450687097534, 'distance': 0.4717098625804932, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6620796215993948, 'distance': 0.6758407568012104, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:31:45,085 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '张三的工作地点属于哪个城市或区域？': found 2 docs.
2025-06-05 12:31:45,085 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '张三的工作地点属于哪个城市或区域？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.5145924687385559}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}]
2025-06-05 12:31:45,085 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '张三的工作地点属于哪个城市或区域？': found 2 potential docs.
2025-06-05 12:31:45,085 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '张三的工作地点属于哪个城市或区域？'
2025-06-05 12:31:45,601 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '张三的工作地点属于哪个城市或区域？' raw output: []
2025-06-05 12:31:45,601 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '张三的工作地点属于哪个城市或区域？': found 0 results.
2025-06-05 12:31:45,601 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '张三是否在全职或兼职状态下工作？'
2025-06-05 12:31:45,609 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '张三是否在全职或兼职状态下工作？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7721326082874234, 'distance': 0.4557347834251533, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6798799292126996, 'distance': 0.6402401415746009, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:31:45,609 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '张三是否在全职或兼职状态下工作？': found 2 docs.
2025-06-05 12:31:45,609 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '张三是否在全职或兼职状态下工作？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.25729623436927795}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}]
2025-06-05 12:31:45,609 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '张三是否在全职或兼职状态下工作？': found 2 potential docs.
2025-06-05 12:31:45,609 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '张三是否在全职或兼职状态下工作？'
2025-06-05 12:31:46,104 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '张三是否在全职或兼职状态下工作？' raw output: []
2025-06-05 12:31:46,104 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '张三是否在全职或兼职状态下工作？': found 0 results.
2025-06-05 12:31:46,104 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '张三在哪里工作？'
2025-06-05 12:31:46,114 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '张三在哪里工作？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7751814238132197, 'distance': 0.4496371523735605, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6303522783352865, 'distance': 0.739295443329427, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:31:46,114 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '张三在哪里工作？': found 2 docs.
2025-06-05 12:31:46,115 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '张三在哪里工作？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.5145924687385559}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}]
2025-06-05 12:31:46,115 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '张三在哪里工作？': found 2 potential docs.
2025-06-05 12:31:46,115 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '张三在哪里工作？'
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '张三在哪里工作？' raw output: []
2025-06-05 12:31:46,661 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '张三在哪里工作？': found 0 results.
2025-06-05 12:31:46,661 - INFO - RagServiceLogger - rag_mcp_service.py:317 - --- [TIME] 结束所有召回, 耗时: 8.57s ---
2025-06-05 12:31:46,661 - INFO - RagServiceLogger - rag_mcp_service.py:318 - --- 总计从各路召回（所有查询处理后）的结果数: 16 ---
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 0 (Summary): type=vector_chroma, score=0.7867591364914212, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 1 (Summary): type=vector_chroma, score=0.6887914454651377, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 2 (Summary): type=keyword_bm25s, score=0.5145924687385559, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:31:46,661 - INFO - RagServiceLogger - rag_mcp_service.py:332 - --- [TIME] 开始结果融合与重排序 at 38.80s ---
2025-06-05 12:31:46,661 - INFO - RagServiceLogger - fusion_engine.py:144 - FusionEngine: Fusing 16 raw retrieved documents for query: '张三在哪里工作？'. Target top_n_final: 3
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.5145924687385559 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7641450687097534 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6620796215993948 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.5145924687385559 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7721326082874234 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6798799292126996 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,661 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.25729623436927795 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7751814238132197 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6303522783352865 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.5145924687385559 vs existing 0.7867591364914212. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6887914454651377. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:31:46,662 - INFO - RagServiceLogger - fusion_engine.py:170 - FusionEngine: After deduplication (content hash): 2 documents.
2025-06-05 12:31:46,662 - INFO - RagServiceLogger - fusion_engine.py:189 - FusionEngine: Starting light screening for 2 unique documents.
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:216 -   Screening: Doc 0 (ID: N/A) passed light screening.
2025-06-05 12:31:46,662 - DEBUG - RagServiceLogger - fusion_engine.py:209 -   Screening: Doc 1 (ID: N/A) failed Jaccard check. Similarity: 0.0000 < 0.05. Content: '第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:31:46,662 - INFO - RagServiceLogger - fusion_engine.py:218 - FusionEngine: After light screening: 1 documents remain.
2025-06-05 12:31:46,690 - INFO - RagServiceLogger - fusion_engine.py:95 - FusionEngine: Reranking 1 documents with CrossEncoder...
2025-06-05 12:31:46,820 - INFO - RagServiceLogger - fusion_engine.py:116 - FusionEngine: Reranking complete. 1 documents sorted.
2025-06-05 12:31:46,820 - INFO - RagServiceLogger - fusion_engine.py:238 - FusionEngine: After reranking: 1 documents.
2025-06-05 12:31:46,820 - DEBUG - RagServiceLogger - fusion_engine.py:240 -   Reranked Doc 0: type=vector_chroma, new_score=6.7031, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:31:46,820 - INFO - RagServiceLogger - fusion_engine.py:245 - FusionEngine: Returning final top 1 documents.
2025-06-05 12:31:46,820 - INFO - RagServiceLogger - rag_mcp_service.py:348 - DEBUG_MODEL_DUMP: First item of log_final_context_docs_summary (from model_dump()): {"source_type": "vector_chroma", "content": "项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。", "score": 6.703125, "metadata": {"chunk_char_length": 29, "chunk_number": 1, "chunk_text": "项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。", "filename": "doc1.txt", "size_bytes": 77, "source_directory": "/home/zhz/zhz_agent/data/raw_documents/", "total_chunks_for_doc": 1, "original_query_part": "张三目前的具体工作地点是哪里？"}}
2025-06-05 12:31:46,821 - INFO - RagServiceLogger - rag_mcp_service.py:351 - --- [TIME] 结束结果融合与重排序, 耗时: 0.16s. Final context docs: 1 ---
2025-06-05 12:31:46,821 - DEBUG - RagServiceLogger - rag_mcp_service.py:354 -    Fused Doc 0 (Summary): type=vector_chroma, score=6.703125, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:31:46,821 - INFO - RagServiceLogger - rag_mcp_service.py:376 - 
--- FUSED CONTEXT for LLM (length: 80 chars) ---
2025-06-05 12:31:46,821 - INFO - RagServiceLogger - rag_mcp_service.py:377 - Source Type: vector_chroma, Score: 6.7031
Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:31:46,821 - INFO - RagServiceLogger - rag_mcp_service.py:378 - --- END OF FUSED CONTEXT ---

2025-06-05 12:31:46,821 - INFO - RagServiceLogger - rag_mcp_service.py:380 - --- [TIME] 开始最终答案生成 at 38.96s ---
2025-06-05 12:31:55,178 - INFO - RagServiceLogger - rag_mcp_service.py:384 - --- [TIME] 结束最终答案生成, 耗时: 8.36s ---
2025-06-05 12:31:55,179 - INFO - RagServiceLogger - rag_mcp_service.py:398 - --- 'query_rag_v2' 逻辑执行完毕, 总耗时: 47.31s. ---
2025-06-05 12:31:55,180 - INFO - RagServiceLogger - rag_mcp_service.py:462 - Full RAG interaction log (ID: 5dd63533-17d8-47bc-b670-f9cdd675913c) has been written.
2025-06-05 12:32:05,564 - INFO - RagServiceLogger - rag_mcp_service.py:181 - 
--- RAG Service (query_rag_v2): 接收到查询: '项目Alpha的文档编写任务分配给了谁？' ---
2025-06-05 12:32:05,564 - INFO - RagServiceLogger - rag_mcp_service.py:182 -       Params: top_k_vector=5, top_k_kg=3, top_k_bm25=3, top_k_final=3
2025-06-05 12:32:05,564 - INFO - RagServiceLogger - rag_mcp_service.py:200 - --- [TIME] 开始意图分类 at 0.00s ---
2025-06-05 12:32:24,677 - INFO - RagServiceLogger - rag_mcp_service.py:204 - --- [TIME] 结束意图分类, 耗时: 19.11s. Result: {'clarification_needed': False, 'reason': 'LLM分类失败或无结果。'}
2025-06-05 12:32:24,677 - INFO - RagServiceLogger - rag_mcp_service.py:220 - --- 查询清晰，无需澄清。将对原始查询 '项目Alpha的文档编写任务分配给了谁？' 进行查询扩展 ---
2025-06-05 12:32:37,480 - INFO - RagServiceLogger - rag_mcp_service.py:232 - --- 扩展后的查询列表 (共 4 个): ['项目Alpha的文档编写任务由谁负责执行？', '文档编写任务的具体内容和分工如何分配？', '项目Alpha的文档编写任务是否涉及跨部门协作？', '项目Alpha的文档编写任务分配给了谁？']. 耗时: 12.80s ---
2025-06-05 12:32:37,480 - INFO - RagServiceLogger - rag_mcp_service.py:237 - --- [TIME] 开始并行召回 for 4 queries at 31.92s ---
2025-06-05 12:32:37,480 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '项目Alpha的文档编写任务由谁负责执行？'
2025-06-05 12:32:37,511 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '项目Alpha的文档编写任务由谁负责执行？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.8663428193762523, 'distance': 0.2673143612474952, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7532964203210739, 'distance': 0.4934071593578523, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:32:37,511 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '项目Alpha的文档编写任务由谁负责执行？': found 2 docs.
2025-06-05 12:32:37,512 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '项目Alpha的文档编写任务由谁负责执行？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 1.354158878326416}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}]
2025-06-05 12:32:37,514 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '项目Alpha的文档编写任务由谁负责执行？': found 2 potential docs.
2025-06-05 12:32:37,514 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '项目Alpha的文档编写任务由谁负责执行？'
2025-06-05 12:32:43,939 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '项目Alpha的文档编写任务由谁负责执行？' raw output: []
2025-06-05 12:32:43,939 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '项目Alpha的文档编写任务由谁负责执行？': found 0 results.
2025-06-05 12:32:43,939 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '文档编写任务的具体内容和分工如何分配？'
2025-06-05 12:32:43,947 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '文档编写任务的具体内容和分工如何分配？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.8551838638290905, 'distance': 0.2896322723418189, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7364195468021517, 'distance': 0.5271609063956967, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:32:43,947 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '文档编写任务的具体内容和分工如何分配？': found 2 docs.
2025-06-05 12:32:43,947 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '文档编写任务的具体内容和分工如何分配？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 1.0968626737594604}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}]
2025-06-05 12:32:43,947 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '文档编写任务的具体内容和分工如何分配？': found 2 potential docs.
2025-06-05 12:32:43,947 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '文档编写任务的具体内容和分工如何分配？'
2025-06-05 12:32:44,492 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '文档编写任务的具体内容和分工如何分配？' raw output: []
2025-06-05 12:32:44,492 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '文档编写任务的具体内容和分工如何分配？': found 0 results.
2025-06-05 12:32:44,492 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '项目Alpha的文档编写任务是否涉及跨部门协作？'
2025-06-05 12:32:44,501 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '项目Alpha的文档编写任务是否涉及跨部门协作？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.842448957206889, 'distance': 0.3151020855862222, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7467386515095181, 'distance': 0.5065226969809637, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:32:44,501 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '项目Alpha的文档编写任务是否涉及跨部门协作？': found 2 docs.
2025-06-05 12:32:44,501 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '项目Alpha的文档编写任务是否涉及跨部门协作？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 1.354158878326416}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}]
2025-06-05 12:32:44,501 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '项目Alpha的文档编写任务是否涉及跨部门协作？': found 2 potential docs.
2025-06-05 12:32:44,501 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '项目Alpha的文档编写任务是否涉及跨部门协作？'
2025-06-05 12:32:45,090 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '项目Alpha的文档编写任务是否涉及跨部门协作？' raw output: []
2025-06-05 12:32:45,090 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '项目Alpha的文档编写任务是否涉及跨部门协作？': found 0 results.
2025-06-05 12:32:45,090 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '项目Alpha的文档编写任务分配给了谁？'
2025-06-05 12:32:45,102 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '项目Alpha的文档编写任务分配给了谁？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.903962508043018, 'distance': 0.19207498391396383, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7558951487889674, 'distance': 0.4882097024220653, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:32:45,102 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '项目Alpha的文档编写任务分配给了谁？': found 2 docs.
2025-06-05 12:32:45,103 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '项目Alpha的文档编写任务分配给了谁？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 2.193725347518921}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.1581256240606308}]
2025-06-05 12:32:45,103 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '项目Alpha的文档编写任务分配给了谁？': found 2 potential docs.
2025-06-05 12:32:45,103 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '项目Alpha的文档编写任务分配给了谁？'
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '项目Alpha的文档编写任务分配给了谁？' raw output: []
2025-06-05 12:32:45,594 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '项目Alpha的文档编写任务分配给了谁？': found 0 results.
2025-06-05 12:32:45,594 - INFO - RagServiceLogger - rag_mcp_service.py:317 - --- [TIME] 结束所有召回, 耗时: 8.11s ---
2025-06-05 12:32:45,594 - INFO - RagServiceLogger - rag_mcp_service.py:318 - --- 总计从各路召回（所有查询处理后）的结果数: 16 ---
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 0 (Summary): type=vector_chroma, score=0.8663428193762523, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 1 (Summary): type=vector_chroma, score=0.7532964203210739, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 2 (Summary): type=keyword_bm25s, score=1.354158878326416, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:32:45,594 - INFO - RagServiceLogger - rag_mcp_service.py:332 - --- [TIME] 开始结果融合与重排序 at 40.03s ---
2025-06-05 12:32:45,594 - INFO - RagServiceLogger - fusion_engine.py:144 - FusionEngine: Fusing 16 raw retrieved documents for query: '项目Alpha的文档编写任务分配给了谁？'. Target top_n_final: 3
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 1.354158878326416 vs existing 1.354158878326416. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7532964203210739. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.8551838638290905 vs existing 1.354158878326416. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7364195468021517 vs existing 0.7532964203210739. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 1.0968626737594604 vs existing 1.354158878326416. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7532964203210739. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,594 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.842448957206889 vs existing 1.354158878326416. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7467386515095181 vs existing 0.7532964203210739. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 1.354158878326416 vs existing 1.354158878326416. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7532964203210739. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.903962508043018 vs existing 1.354158878326416. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7558951487889674 vs existing 0.7558951487889674. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 2.193725347518921 vs existing 2.193725347518921. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.1581256240606308 vs existing 0.7558951487889674. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,595 - INFO - RagServiceLogger - fusion_engine.py:170 - FusionEngine: After deduplication (content hash): 2 documents.
2025-06-05 12:32:45,595 - INFO - RagServiceLogger - fusion_engine.py:189 - FusionEngine: Starting light screening for 2 unique documents.
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:216 -   Screening: Doc 0 (ID: 425087b5-58ed-47f3-ade3-69ebca135812) passed light screening.
2025-06-05 12:32:45,595 - DEBUG - RagServiceLogger - fusion_engine.py:216 -   Screening: Doc 1 (ID: N/A) passed light screening.
2025-06-05 12:32:45,595 - INFO - RagServiceLogger - fusion_engine.py:218 - FusionEngine: After light screening: 2 documents remain.
2025-06-05 12:32:45,624 - INFO - RagServiceLogger - fusion_engine.py:95 - FusionEngine: Reranking 2 documents with CrossEncoder...
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - fusion_engine.py:116 - FusionEngine: Reranking complete. 2 documents sorted.
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - fusion_engine.py:238 - FusionEngine: After reranking: 2 documents.
2025-06-05 12:32:45,662 - DEBUG - RagServiceLogger - fusion_engine.py:240 -   Reranked Doc 0: type=keyword_bm25s, new_score=9.2578, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:32:45,662 - DEBUG - RagServiceLogger - fusion_engine.py:240 -   Reranked Doc 1: type=vector_chroma, new_score=-10.1953, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - fusion_engine.py:245 - FusionEngine: Returning final top 2 documents.
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - rag_mcp_service.py:348 - DEBUG_MODEL_DUMP: First item of log_final_context_docs_summary (from model_dump()): {"source_type": "keyword_bm25s", "content": "项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。", "score": 9.2578125, "metadata": {"chunk_id": "425087b5-58ed-47f3-ade3-69ebca135812", "original_query_part": "项目Alpha的文档编写任务分配给了谁？"}}
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - rag_mcp_service.py:351 - --- [TIME] 结束结果融合与重排序, 耗时: 0.07s. Final context docs: 2 ---
2025-06-05 12:32:45,662 - DEBUG - RagServiceLogger - rag_mcp_service.py:354 -    Fused Doc 0 (Summary): type=keyword_bm25s, score=9.2578125, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:32:45,662 - DEBUG - RagServiceLogger - rag_mcp_service.py:354 -    Fused Doc 1 (Summary): type=vector_chroma, score=-10.1953125, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - rag_mcp_service.py:376 - 
--- FUSED CONTEXT for LLM (length: 157 chars) ---
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - rag_mcp_service.py:377 - Source Type: keyword_bm25s, Score: 9.2578
Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。

---

Source Type: vector_chroma, Score: -10.1953
Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:32:45,662 - INFO - RagServiceLogger - rag_mcp_service.py:378 - --- END OF FUSED CONTEXT ---

2025-06-05 12:32:45,662 - INFO - RagServiceLogger - rag_mcp_service.py:380 - --- [TIME] 开始最终答案生成 at 40.10s ---
2025-06-05 12:32:54,586 - INFO - RagServiceLogger - rag_mcp_service.py:384 - --- [TIME] 结束最终答案生成, 耗时: 8.92s ---
2025-06-05 12:32:54,586 - INFO - RagServiceLogger - rag_mcp_service.py:398 - --- 'query_rag_v2' 逻辑执行完毕, 总耗时: 49.02s. ---
2025-06-05 12:32:54,587 - INFO - RagServiceLogger - rag_mcp_service.py:462 - Full RAG interaction log (ID: 79bdcabd-bcc2-4709-9d4c-2ca12a5afd9f) has been written.
2025-06-05 12:33:06,278 - INFO - RagServiceLogger - rag_mcp_service.py:181 - 
--- RAG Service (query_rag_v2): 接收到查询: '总结一下doc1.txt的主要内容。' ---
2025-06-05 12:33:06,278 - INFO - RagServiceLogger - rag_mcp_service.py:182 -       Params: top_k_vector=5, top_k_kg=3, top_k_bm25=3, top_k_final=3
2025-06-05 12:33:06,278 - INFO - RagServiceLogger - rag_mcp_service.py:200 - --- [TIME] 开始意图分类 at 0.00s ---
2025-06-05 12:33:25,733 - INFO - RagServiceLogger - rag_mcp_service.py:204 - --- [TIME] 结束意图分类, 耗时: 19.45s. Result: {'clarification_needed': False, 'reason': 'LLM分类失败或无结果。'}
2025-06-05 12:33:25,733 - INFO - RagServiceLogger - rag_mcp_service.py:220 - --- 查询清晰，无需澄清。将对原始查询 '总结一下doc1.txt的主要内容。' 进行查询扩展 ---
2025-06-05 12:33:41,096 - INFO - RagServiceLogger - rag_mcp_service.py:232 - --- 扩展后的查询列表 (共 4 个): ['文档的结构划分是否包含特定章节或分节？', '文档中有哪些核心论点或主要数据需要重点概括？', '文档中是否存在关键结论或建议？', '总结一下doc1.txt的主要内容。']. 耗时: 15.36s ---
2025-06-05 12:33:41,097 - INFO - RagServiceLogger - rag_mcp_service.py:237 - --- [TIME] 开始并行召回 for 4 queries at 34.82s ---
2025-06-05 12:33:41,097 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '文档的结构划分是否包含特定章节或分节？'
2025-06-05 12:33:41,124 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '文档的结构划分是否包含特定章节或分节？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7562013896162265, 'distance': 0.48759722076754686, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7143654919328178, 'distance': 0.5712690161343643, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:33:41,124 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '文档的结构划分是否包含特定章节或分节？': found 2 docs.
2025-06-05 12:33:41,125 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '文档的结构划分是否包含特定章节或分节？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.324974000453949}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}]
2025-06-05 12:33:41,127 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '文档的结构划分是否包含特定章节或分节？': found 2 potential docs.
2025-06-05 12:33:41,127 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '文档的结构划分是否包含特定章节或分节？'
2025-06-05 12:33:47,401 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '文档的结构划分是否包含特定章节或分节？' raw output: []
2025-06-05 12:33:47,401 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '文档的结构划分是否包含特定章节或分节？': found 0 results.
2025-06-05 12:33:47,401 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '文档中有哪些核心论点或主要数据需要重点概括？'
2025-06-05 12:33:47,415 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '文档中有哪些核心论点或主要数据需要重点概括？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7425170610105933, 'distance': 0.5149658779788133, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7161651467322423, 'distance': 0.5676697065355154, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:33:47,415 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '文档中有哪些核心论点或主要数据需要重点概括？': found 2 docs.
2025-06-05 12:33:47,415 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '文档中有哪些核心论点或主要数据需要重点概括？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.06767776608467102}]
2025-06-05 12:33:47,415 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '文档中有哪些核心论点或主要数据需要重点概括？': found 2 potential docs.
2025-06-05 12:33:47,415 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '文档中有哪些核心论点或主要数据需要重点概括？'
2025-06-05 12:33:47,944 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '文档中有哪些核心论点或主要数据需要重点概括？' raw output: []
2025-06-05 12:33:47,945 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '文档中有哪些核心论点或主要数据需要重点概括？': found 0 results.
2025-06-05 12:33:47,945 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '文档中是否存在关键结论或建议？'
2025-06-05 12:33:47,967 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '文档中是否存在关键结论或建议？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7731468848061236, 'distance': 0.4537062303877528, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7370770164860636, 'distance': 0.5258459670278727, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:33:47,967 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '文档中是否存在关键结论或建议？': found 2 docs.
2025-06-05 12:33:47,967 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '文档中是否存在关键结论或建议？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.06767776608467102}]
2025-06-05 12:33:47,967 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '文档中是否存在关键结论或建议？': found 2 potential docs.
2025-06-05 12:33:47,967 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '文档中是否存在关键结论或建议？'
2025-06-05 12:33:48,469 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '文档中是否存在关键结论或建议？' raw output: []
2025-06-05 12:33:48,469 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '文档中是否存在关键结论或建议？': found 0 results.
2025-06-05 12:33:48,469 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '总结一下doc1.txt的主要内容。'
2025-06-05 12:33:48,481 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '总结一下doc1.txt的主要内容。' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7796052798097877, 'distance': 0.4407894403804248, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7713835766155224, 'distance': 0.45723284676895526, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:33:48,481 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '总结一下doc1.txt的主要内容。': found 2 docs.
2025-06-05 12:33:48,482 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '总结一下doc1.txt的主要内容。' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.35600942373275757}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0790628120303154}]
2025-06-05 12:33:48,482 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '总结一下doc1.txt的主要内容。': found 2 potential docs.
2025-06-05 12:33:48,482 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '总结一下doc1.txt的主要内容。'
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '总结一下doc1.txt的主要内容。' raw output: []
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '总结一下doc1.txt的主要内容。': found 0 results.
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - rag_mcp_service.py:317 - --- [TIME] 结束所有召回, 耗时: 8.01s ---
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - rag_mcp_service.py:318 - --- 总计从各路召回（所有查询处理后）的结果数: 16 ---
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 0 (Summary): type=vector_chroma, score=0.7562013896162265, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 1 (Summary): type=vector_chroma, score=0.7143654919328178, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 2 (Summary): type=keyword_bm25s, score=0.324974000453949, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - rag_mcp_service.py:332 - --- [TIME] 开始结果融合与重排序 at 42.83s ---
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - fusion_engine.py:144 - FusionEngine: Fusing 16 raw retrieved documents for query: '总结一下doc1.txt的主要内容。'. Target top_n_final: 3
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.324974000453949 vs existing 0.7562013896162265. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7143654919328178. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7425170610105933 vs existing 0.7425170610105933. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7161651467322423 vs existing 0.7562013896162265. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7425170610105933. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.06767776608467102 vs existing 0.7562013896162265. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7731468848061236 vs existing 0.7731468848061236. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7370770164860636 vs existing 0.7562013896162265. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7731468848061236. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.06767776608467102 vs existing 0.7562013896162265. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7796052798097877 vs existing 0.7796052798097877. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7713835766155224 vs existing 0.7731468848061236. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.35600942373275757 vs existing 0.7796052798097877. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0790628120303154 vs existing 0.7731468848061236. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - fusion_engine.py:170 - FusionEngine: After deduplication (content hash): 2 documents.
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - fusion_engine.py:189 - FusionEngine: Starting light screening for 2 unique documents.
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:216 -   Screening: Doc 0 (ID: N/A) passed light screening.
2025-06-05 12:33:49,109 - DEBUG - RagServiceLogger - fusion_engine.py:216 -   Screening: Doc 1 (ID: N/A) passed light screening.
2025-06-05 12:33:49,109 - INFO - RagServiceLogger - fusion_engine.py:218 - FusionEngine: After light screening: 2 documents remain.
2025-06-05 12:33:49,133 - INFO - RagServiceLogger - fusion_engine.py:95 - FusionEngine: Reranking 2 documents with CrossEncoder...
2025-06-05 12:33:49,177 - INFO - RagServiceLogger - fusion_engine.py:116 - FusionEngine: Reranking complete. 2 documents sorted.
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - fusion_engine.py:238 - FusionEngine: After reranking: 2 documents.
2025-06-05 12:33:49,178 - DEBUG - RagServiceLogger - fusion_engine.py:240 -   Reranked Doc 0: type=vector_chroma, new_score=-3.5723, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:33:49,178 - DEBUG - RagServiceLogger - fusion_engine.py:240 -   Reranked Doc 1: type=vector_chroma, new_score=-3.8320, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - fusion_engine.py:245 - FusionEngine: Returning final top 2 documents.
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - rag_mcp_service.py:348 - DEBUG_MODEL_DUMP: First item of log_final_context_docs_summary (from model_dump()): {"source_type": "vector_chroma", "content": "项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。", "score": -3.572265625, "metadata": {"chunk_char_length": 29, "chunk_number": 1, "chunk_text": "项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。", "filename": "doc1.txt", "size_bytes": 77, "source_directory": "/home/zhz/zhz_agent/data/raw_documents/", "total_chunks_for_doc": 1, "original_query_part": "总结一下doc1.txt的主要内容。"}}
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - rag_mcp_service.py:351 - --- [TIME] 结束结果融合与重排序, 耗时: 0.07s. Final context docs: 2 ---
2025-06-05 12:33:49,178 - DEBUG - RagServiceLogger - rag_mcp_service.py:354 -    Fused Doc 0 (Summary): type=vector_chroma, score=-3.572265625, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:33:49,178 - DEBUG - RagServiceLogger - rag_mcp_service.py:354 -    Fused Doc 1 (Summary): type=vector_chroma, score=-3.83203125, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - rag_mcp_service.py:376 - 
--- FUSED CONTEXT for LLM (length: 157 chars) ---
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - rag_mcp_service.py:377 - Source Type: vector_chroma, Score: -3.5723
Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。

---

Source Type: vector_chroma, Score: -3.8320
Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:33:49,178 - INFO - RagServiceLogger - rag_mcp_service.py:378 - --- END OF FUSED CONTEXT ---

2025-06-05 12:33:49,178 - INFO - RagServiceLogger - rag_mcp_service.py:380 - --- [TIME] 开始最终答案生成 at 42.90s ---
2025-06-05 12:34:17,915 - INFO - RagServiceLogger - rag_mcp_service.py:384 - --- [TIME] 结束最终答案生成, 耗时: 28.74s ---
2025-06-05 12:34:17,915 - INFO - RagServiceLogger - rag_mcp_service.py:398 - --- 'query_rag_v2' 逻辑执行完毕, 总耗时: 71.64s. ---
2025-06-05 12:34:17,916 - INFO - RagServiceLogger - rag_mcp_service.py:462 - Full RAG interaction log (ID: da7c60ea-ad9c-4f57-b13d-cb8cbf870462) has been written.
2025-06-05 12:34:39,466 - INFO - RagServiceLogger - rag_mcp_service.py:181 - 
--- RAG Service (query_rag_v2): 接收到查询: '今天天气怎么样？' ---
2025-06-05 12:34:39,466 - INFO - RagServiceLogger - rag_mcp_service.py:182 -       Params: top_k_vector=5, top_k_kg=3, top_k_bm25=3, top_k_final=3
2025-06-05 12:34:39,466 - INFO - RagServiceLogger - rag_mcp_service.py:200 - --- [TIME] 开始意图分类 at 0.00s ---
2025-06-05 12:34:59,749 - INFO - RagServiceLogger - rag_mcp_service.py:204 - --- [TIME] 结束意图分类, 耗时: 20.28s. Result: {'clarification_needed': False, 'reason': 'LLM分类失败或无结果。'}
2025-06-05 12:34:59,749 - INFO - RagServiceLogger - rag_mcp_service.py:220 - --- 查询清晰，无需澄清。将对原始查询 '今天天气怎么样？' 进行查询扩展 ---
2025-06-05 12:35:11,817 - INFO - RagServiceLogger - rag_mcp_service.py:232 - --- 扩展后的查询列表 (共 4 个): ['今天气温范围和天气状况如何？', '影响今天天气的主要因素有哪些？', '今天天气是否适合出行或户外活动？', '今天天气怎么样？']. 耗时: 12.07s ---
2025-06-05 12:35:11,817 - INFO - RagServiceLogger - rag_mcp_service.py:237 - --- [TIME] 开始并行召回 for 4 queries at 32.35s ---
2025-06-05 12:35:11,817 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '今天气温范围和天气状况如何？'
2025-06-05 12:35:11,829 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '今天气温范围和天气状况如何？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6609606554269477, 'distance': 0.6780786891461046, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.6288368309478083, 'distance': 0.7423263381043833, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:35:11,829 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '今天气温范围和天气状况如何？': found 2 docs.
2025-06-05 12:35:11,830 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '今天气温范围和天气状况如何？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.0}]
2025-06-05 12:35:11,832 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '今天气温范围和天气状况如何？': found 2 potential docs.
2025-06-05 12:35:11,832 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '今天气温范围和天气状况如何？'
2025-06-05 12:35:18,301 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '今天气温范围和天气状况如何？' raw output: []
2025-06-05 12:35:18,301 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '今天气温范围和天气状况如何？': found 0 results.
2025-06-05 12:35:18,301 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '影响今天天气的主要因素有哪些？'
2025-06-05 12:35:18,315 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '影响今天天气的主要因素有哪些？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6548067856532859, 'distance': 0.6903864286934283, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.6297128473214245, 'distance': 0.740574305357151, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:35:18,315 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '影响今天天气的主要因素有哪些？': found 2 docs.
2025-06-05 12:35:18,316 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '影响今天天气的主要因素有哪些？' raw output (IDs and scores): [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.25729623436927795}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}]
2025-06-05 12:35:18,316 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '影响今天天气的主要因素有哪些？': found 2 potential docs.
2025-06-05 12:35:18,316 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '影响今天天气的主要因素有哪些？'
2025-06-05 12:35:18,837 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '影响今天天气的主要因素有哪些？' raw output: []
2025-06-05 12:35:18,837 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '影响今天天气的主要因素有哪些？': found 0 results.
2025-06-05 12:35:18,837 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '今天天气是否适合出行或户外活动？'
2025-06-05 12:35:18,851 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '今天天气是否适合出行或户外活动？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6799993212400485, 'distance': 0.6400013575199031, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.6486423417951616, 'distance': 0.7027153164096769, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:35:18,851 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '今天天气是否适合出行或户外活动？': found 2 docs.
2025-06-05 12:35:18,852 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '今天天气是否适合出行或户外活动？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.0}]
2025-06-05 12:35:18,852 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '今天天气是否适合出行或户外活动？': found 2 potential docs.
2025-06-05 12:35:18,852 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '今天天气是否适合出行或户外活动？'
2025-06-05 12:35:19,443 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '今天天气是否适合出行或户外活动？' raw output: []
2025-06-05 12:35:19,443 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '今天天气是否适合出行或户外活动？': found 0 results.
2025-06-05 12:35:19,443 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '今天天气怎么样？'
2025-06-05 12:35:19,464 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '今天天气怎么样？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6316905836021479, 'distance': 0.7366188327957042, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.5905228632028737, 'distance': 0.8189542735942525, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 12:35:19,464 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '今天天气怎么样？': found 2 docs.
2025-06-05 12:35:19,464 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '今天天气怎么样？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.0}]
2025-06-05 12:35:19,465 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '今天天气怎么样？': found 2 potential docs.
2025-06-05 12:35:19,465 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '今天天气怎么样？'
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '今天天气怎么样？' raw output: []
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '今天天气怎么样？': found 0 results.
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - rag_mcp_service.py:317 - --- [TIME] 结束所有召回, 耗时: 8.12s ---
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - rag_mcp_service.py:318 - --- 总计从各路召回（所有查询处理后）的结果数: 16 ---
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 0 (Summary): type=vector_chroma, score=0.6609606554269477, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 1 (Summary): type=vector_chroma, score=0.6288368309478083, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 2 (Summary): type=keyword_bm25s, score=0.0, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - rag_mcp_service.py:332 - --- [TIME] 开始结果融合与重排序 at 40.48s ---
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - fusion_engine.py:144 - FusionEngine: Fusing 16 raw retrieved documents for query: '今天天气怎么样？'. Target top_n_final: 3
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6609606554269477. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6288368309478083. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6548067856532859 vs existing 0.6609606554269477. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6297128473214245 vs existing 0.6297128473214245. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.25729623436927795 vs existing 0.6297128473214245. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6609606554269477. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6799993212400485 vs existing 0.6799993212400485. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6486423417951616 vs existing 0.6486423417951616. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6799993212400485. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6486423417951616. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6316905836021479 vs existing 0.6799993212400485. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.5905228632028737 vs existing 0.6486423417951616. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6799993212400485. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6486423417951616. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - fusion_engine.py:170 - FusionEngine: After deduplication (content hash): 2 documents.
2025-06-05 12:35:19,941 - INFO - RagServiceLogger - fusion_engine.py:189 - FusionEngine: Starting light screening for 2 unique documents.
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:209 -   Screening: Doc 0 (ID: N/A) failed Jaccard check. Similarity: 0.0000 < 0.05. Content: '第二个文档讨论了自然语言处理技术。...'
2025-06-05 12:35:19,941 - DEBUG - RagServiceLogger - fusion_engine.py:209 -   Screening: Doc 1 (ID: N/A) failed Jaccard check. Similarity: 0.0000 < 0.05. Content: '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 12:35:19,942 - INFO - RagServiceLogger - fusion_engine.py:218 - FusionEngine: After light screening: 0 documents remain.
2025-06-05 12:35:19,942 - INFO - RagServiceLogger - fusion_engine.py:221 - FusionEngine: No documents remain after light screening. Returning empty list.
2025-06-05 12:35:19,942 - INFO - RagServiceLogger - rag_mcp_service.py:351 - --- [TIME] 结束结果融合与重排序, 耗时: 0.00s. Final context docs: 0 ---
2025-06-05 12:35:19,942 - INFO - RagServiceLogger - rag_mcp_service.py:398 - --- 'query_rag_v2' 逻辑执行完毕, 总耗时: 40.48s. ---
2025-06-05 12:35:19,942 - INFO - RagServiceLogger - rag_mcp_service.py:462 - Full RAG interaction log (ID: 2a261917-261a-4e18-922e-4e95c8930bf3) has been written.
2025-06-05 13:12:18,411 - INFO - RagServiceLogger - rag_mcp_service.py:181 - 
--- RAG Service (query_rag_v2): 接收到查询: '人工智能在客户服务中有哪些应用场景？' ---
2025-06-05 13:12:18,411 - INFO - RagServiceLogger - rag_mcp_service.py:182 -       Params: top_k_vector=5, top_k_kg=3, top_k_bm25=3, top_k_final=3
2025-06-05 13:12:18,411 - INFO - RagServiceLogger - rag_mcp_service.py:200 - --- [TIME] 开始意图分类 at 0.00s ---
2025-06-05 13:12:37,888 - INFO - RagServiceLogger - rag_mcp_service.py:204 - --- [TIME] 结束意图分类, 耗时: 19.48s. Result: {'clarification_needed': False, 'reason': 'LLM分类失败或无结果。'}
2025-06-05 13:12:37,889 - INFO - RagServiceLogger - rag_mcp_service.py:220 - --- 查询清晰，无需澄清。将对原始查询 '人工智能在客户服务中有哪些应用场景？' 进行查询扩展 ---
2025-06-05 13:12:53,146 - INFO - RagServiceLogger - rag_mcp_service.py:232 - --- 扩展后的查询列表 (共 4 个): ['人工智能在客户服务中主要应用于哪些具体领域？', '自然语言处理技术如何提升客户服务的交互体验？', '人工智能在客户预测和个性化服务方面有哪些创新应用？', '人工智能在客户服务中有哪些应用场景？']. 耗时: 15.26s ---
2025-06-05 13:12:53,146 - INFO - RagServiceLogger - rag_mcp_service.py:237 - --- [TIME] 开始并行召回 for 4 queries at 34.73s ---
2025-06-05 13:12:53,146 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '人工智能在客户服务中主要应用于哪些具体领域？'
2025-06-05 13:12:53,183 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '人工智能在客户服务中主要应用于哪些具体领域？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.709173068491901, 'distance': 0.581653863016198, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6743691779158673, 'distance': 0.6512616441682655, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 13:12:53,183 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '人工智能在客户服务中主要应用于哪些具体领域？': found 2 docs.
2025-06-05 13:12:53,183 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '人工智能在客户服务中主要应用于哪些具体领域？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.0}]
2025-06-05 13:12:53,185 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '人工智能在客户服务中主要应用于哪些具体领域？': found 2 potential docs.
2025-06-05 13:12:53,185 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '人工智能在客户服务中主要应用于哪些具体领域？'
2025-06-05 13:12:59,292 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '人工智能在客户服务中主要应用于哪些具体领域？' raw output: []
2025-06-05 13:12:59,292 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '人工智能在客户服务中主要应用于哪些具体领域？': found 0 results.
2025-06-05 13:12:59,292 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '自然语言处理技术如何提升客户服务的交互体验？'
2025-06-05 13:12:59,313 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '自然语言处理技术如何提升客户服务的交互体验？' raw output: [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.8063962578767718, 'distance': 0.38720748424645646, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.6775817103293293, 'distance': 0.6448365793413413, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 13:12:59,313 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '自然语言处理技术如何提升客户服务的交互体验？': found 2 docs.
2025-06-05 13:12:59,313 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '自然语言处理技术如何提升客户服务的交互体验？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 1.5028986930847168}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.25729623436927795}]
2025-06-05 13:12:59,313 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '自然语言处理技术如何提升客户服务的交互体验？': found 2 potential docs.
2025-06-05 13:12:59,313 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '自然语言处理技术如何提升客户服务的交互体验？'
2025-06-05 13:12:59,891 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '自然语言处理技术如何提升客户服务的交互体验？' raw output: []
2025-06-05 13:12:59,891 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '自然语言处理技术如何提升客户服务的交互体验？': found 0 results.
2025-06-05 13:12:59,891 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '人工智能在客户预测和个性化服务方面有哪些创新应用？'
2025-06-05 13:12:59,911 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '人工智能在客户预测和个性化服务方面有哪些创新应用？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7253360659882387, 'distance': 0.5493278680235225, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.7036240165025432, 'distance': 0.5927519669949135, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 13:12:59,911 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '人工智能在客户预测和个性化服务方面有哪些创新应用？': found 2 docs.
2025-06-05 13:12:59,911 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '人工智能在客户预测和个性化服务方面有哪些创新应用？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.0}]
2025-06-05 13:12:59,911 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '人工智能在客户预测和个性化服务方面有哪些创新应用？': found 2 potential docs.
2025-06-05 13:12:59,911 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '人工智能在客户预测和个性化服务方面有哪些创新应用？'
2025-06-05 13:13:00,443 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '人工智能在客户预测和个性化服务方面有哪些创新应用？' raw output: []
2025-06-05 13:13:00,443 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '人工智能在客户预测和个性化服务方面有哪些创新应用？': found 0 results.
2025-06-05 13:13:00,443 - INFO - RagServiceLogger - rag_mcp_service.py:241 - Processing retrievals for query: '人工智能在客户服务中有哪些应用场景？'
2025-06-05 13:13:00,462 - DEBUG - RagServiceLogger - rag_mcp_service.py:247 -    ChromaDB for '人工智能在客户服务中有哪些应用场景？' raw output: [{'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'score': 0.7176656036403103, 'distance': 0.5646687927193794, 'metadata': {'chunk_char_length': 29, 'chunk_number': 1, 'chunk_text': '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。', 'filename': 'doc1.txt', 'size_bytes': 77, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}, {'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'text': '第二个文档讨论了自然语言处理技术。', 'score': 0.6760496612703446, 'distance': 0.6479006774593108, 'metadata': {'chunk_char_length': 17, 'chunk_number': 1, 'chunk_text': '第二个文档讨论了自然语言处理技术。', 'filename': 'doc2.txt', 'size_bytes': 52, 'source_directory': '/home/zhz/zhz_agent/data/raw_documents/', 'total_chunks_for_doc': 1}}]
2025-06-05 13:13:00,463 - INFO - RagServiceLogger - rag_mcp_service.py:257 -    ChromaDB for '人工智能在客户服务中有哪些应用场景？': found 2 docs.
2025-06-05 13:13:00,463 - DEBUG - RagServiceLogger - rag_mcp_service.py:265 -    BM25 for '人工智能在客户服务中有哪些应用场景？' raw output (IDs and scores): [{'id': 'a67db1e0-f7b4-4de0-aac7-231b236b32a4', 'score': 0.0}, {'id': '425087b5-58ed-47f3-ade3-69ebca135812', 'score': 0.0}]
2025-06-05 13:13:00,463 - INFO - RagServiceLogger - rag_mcp_service.py:295 -    BM25s for '人工智能在客户服务中有哪些应用场景？': found 2 potential docs.
2025-06-05 13:13:00,463 - INFO - RagServiceLogger - rag_mcp_service.py:302 -    Performing KG retrieval for query: '人工智能在客户服务中有哪些应用场景？'
2025-06-05 13:13:00,946 - DEBUG - RagServiceLogger - rag_mcp_service.py:304 -    KG for '人工智能在客户服务中有哪些应用场景？' raw output: []
2025-06-05 13:13:00,946 - INFO - RagServiceLogger - rag_mcp_service.py:313 -    KG Retrieval for '人工智能在客户服务中有哪些应用场景？': found 0 results.
2025-06-05 13:13:00,946 - INFO - RagServiceLogger - rag_mcp_service.py:317 - --- [TIME] 结束所有召回, 耗时: 7.80s ---
2025-06-05 13:13:00,946 - INFO - RagServiceLogger - rag_mcp_service.py:318 - --- 总计从各路召回（所有查询处理后）的结果数: 16 ---
2025-06-05 13:13:00,946 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 0 (Summary): type=vector_chroma, score=0.709173068491901, content='项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 1 (Summary): type=vector_chroma, score=0.6743691779158673, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - rag_mcp_service.py:321 -    Raw Doc 2 (Summary): type=keyword_bm25s, score=0.0, content='第二个文档讨论了自然语言处理技术。...'
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - rag_mcp_service.py:332 - --- [TIME] 开始结果融合与重排序 at 42.54s ---
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - fusion_engine.py:144 - FusionEngine: Fusing 16 raw retrieved documents for query: '人工智能在客户服务中有哪些应用场景？'. Target top_n_final: 3
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.6743691779158673. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.709173068491901. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.8063962578767718 vs existing 0.8063962578767718. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6775817103293293 vs existing 0.709173068491901. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 1.5028986930847168 vs existing 1.5028986930847168. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.25729623436927795 vs existing 0.709173068491901. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7253360659882387 vs existing 0.7253360659882387. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7036240165025432 vs existing 1.5028986930847168. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 1.5028986930847168. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.7253360659882387. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.7176656036403103 vs existing 0.7253360659882387. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.6760496612703446 vs existing 1.5028986930847168. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 1.5028986930847168. Content: 第二个文档讨论了自然语言处理技术。...
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:167 - FusionEngine: Duplicate content hash found. Doc with score 0.0 vs existing 0.7253360659882387. Content: 项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - fusion_engine.py:170 - FusionEngine: After deduplication (content hash): 2 documents.
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - fusion_engine.py:189 - FusionEngine: Starting light screening for 2 unique documents.
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:209 -   Screening: Doc 0 (ID: N/A) failed Jaccard check. Similarity: 0.0000 < 0.05. Content: '项目Alpha的文档编写任务分配给了张三。张三在谷歌工作。...'
2025-06-05 13:13:00,947 - DEBUG - RagServiceLogger - fusion_engine.py:209 -   Screening: Doc 1 (ID: a67db1e0-f7b4-4de0-aac7-231b236b32a4) failed Jaccard check. Similarity: 0.0000 < 0.05. Content: '第二个文档讨论了自然语言处理技术。...'
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - fusion_engine.py:218 - FusionEngine: After light screening: 0 documents remain.
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - fusion_engine.py:221 - FusionEngine: No documents remain after light screening. Returning empty list.
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - rag_mcp_service.py:351 - --- [TIME] 结束结果融合与重排序, 耗时: 0.00s. Final context docs: 0 ---
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - rag_mcp_service.py:398 - --- 'query_rag_v2' 逻辑执行完毕, 总耗时: 42.54s. ---
2025-06-05 13:13:00,947 - INFO - RagServiceLogger - rag_mcp_service.py:462 - Full RAG interaction log (ID: 7dfaf74b-c6b4-4f23-934c-d985f29d9d94) has been written.
2025-06-05 13:16:31,002 - INFO - RagServiceLogger - rag_mcp_service.py:160 - --- RAG Service (FastMCP): 正在清理资源 ---
2025-06-05 13:16:31,006 - INFO - RagServiceLogger - rag_mcp_service.py:163 - --- RAG Service (FastMCP): 清理完成 ---
